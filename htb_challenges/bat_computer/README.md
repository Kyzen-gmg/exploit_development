Raw notes in here. data_dumps.md has raw data and breadcrumbs.

# Bat Computer

# Notes
Breadcrumbs:
- 0x7ffc193786a4
- b4tp@$$w0rd!

## Ghidra
[Ghidra - 8 Vertices](#ghidra-vertices)

![](ghidra01.png)

array size is 76, buffer read size is 137.
```
line 8      undefined auStack84 [76];
line 32     read(0,auStack84,0x89);
```
Create exploit; run  
[exploit.py](exploit.py)

## gdb

![](gdb01.png)

```
>>> cyclic_find('vaaa')
84
```

## py_debug
![](py_debug01.png)

Added Shellcode; payload is too long!!  
remember to do multiple copies of exploit next time to show progression  
[exploit.py](exploit.py)

![](py_debug02.png)

//move shellcode from the end to the beginning; fixed endianess; added popad()  
[exploit2.py](exploit2.py)

//Deliver solution  
[food.py](food.py)

# Key / Flag
```
$ id && cat flag.txt
uid=0(root) gid=0(root) groups=0(root)
HTB{l0v3_y0uR_sh3llf_U_s4v3d_th3_w0rld!}
```

# Helpful Resources

# TODO
//Read through the vertices and annotate/explain what's going on

# Ghidra Vertices

## 001011ec - main
//callconv = stdcall; 6 x 16 = 96 bytes stack
```
undefined8 __stdcall main(void)
       undefined8        RAX:8          <RETURN>
       undefined4        Stack[-0x68]:4 local_68
            main
 001011ec PUSH         RBP
 001011ed MOV          RBP,RSP
 001011f0 SUB          RSP,0x60
 001011f4 MOV          EAX,0x0
 001011f9 CALL         FUN_001011a9
```

## LAB_001011fe
```
            LAB_001011fe
 001011fe LEA          RAX=>local_68,[RBP + -0x60]
 00101202 ADD          RAX,0x4
 00101206 MOV          EDX,0x10
 0010120b MOV          ESI,0x0
 00101210 MOV          RDI,RAX
 00101213 CALL         <EXTERNAL>::memset
 00101218 LEA          RDI,[s_Welcome_to_your_BatComputer,_Bat_00102008]
 0010121f MOV          EAX,0x0
 00101224 CALL         <EXTERNAL>::printf
 00101229 LEA          RAX=>local_68,[RBP + -0x60]
 0010122d MOV          RSI,RAX
 00101230 LEA          RDI,[DAT_00102069]
 00101237 MOV          EAX,0x0
 0010123c CALL         <EXTERNAL>::__isoc99_scanf
 00101241 MOV          EAX,dword ptr [RBP + local_68]
 00101244 CMP          EAX,0x1
 00101247 JNZ          LAB_00101267
```
### 00101249

```
 00101249 LEA          RAX=>local_68,[RBP + -0x60]
 0010124d ADD          RAX,0x14
 00101251 MOV          RSI,RAX
 00101254 LEA          RDI,[s_It_was_very_hard,_but_Alfred_man_00102070]
 0010125b MOV          EAX,0x0
 00101260 CALL         <EXTERNAL>::printf
 00101265 JMP          LAB_001011fe
```

## LAB_00101267
```
            LAB_00101267
 00101267 MOV          EAX,dword ptr [RBP + local_68]
 0010126a CMP          EAX,0x2
 0010126d JNZ          LAB_0010130d
```

### 00101273 LOOP
```
 00101273 LEA          RDI,[s_Ok._Let's_do_this._Enter_the_pas_001020a8]
 0010127a MOV          EAX,0x0
 0010127f CALL         <EXTERNAL>::printf
 00101284 LEA          RAX=>local_68,[RBP + -0x60]
 00101288 ADD          RAX,0x4
 0010128c MOV          RSI,RAX
 0010128f LEA          RDI,[DAT_001020d0]
 00101296 MOV          EAX,0x0
 0010129b CALL         <EXTERNAL>::__isoc99_scanf
 001012a0 LEA          RAX=>local_68,[RBP + -0x60]
 001012a4 ADD          RAX,0x4
 001012a8 LEA          RSI,[s_b4tp@$$w0rd!_001020d5]
 001012af MOV          RDI,RAX
 001012b2 CALL         <EXTERNAL>::strcmp
 001012b7 TEST         EAX,EAX
 001012b9 JZ           LAB_001012d1

```
### 001012bb ELSE
```
 001012bb LEA          RDI,[s_The_password_is_wrong._I_can't_g_001020e8]
 001012c2 CALL         <EXTERNAL>::puts
 001012c7 MOV          EDI,0x0
 001012cc CALL         <EXTERNAL>::exit
```

### LAB_001012d1 IF
```
             LAB_001012d1
 001012d1 LEA          RDI,[s_Access_Granted._Enter_the_naviga_00102130]
 001012d8 MOV          EAX,0x0
 001012dd CALL         <EXTERNAL>::printf
 001012e2 LEA          RAX=>local_68,[RBP + -0x60]
 001012e6 ADD          RAX,0x14
 001012ea MOV          EDX,0x89
 001012ef MOV          RSI,RAX
 001012f2 MOV          EDI,0x0
 001012f7 CALL         <EXTERNAL>::read
 001012fc LEA          RDI,[s_Roger_that!_00102161]
 00101303 CALL         <EXTERNAL>::puts
 00101308 JMP          LAB_001011fe
```
## LAB_0010130d
```
            LAB_0010130d
 0010130d LEA          RDI,[s_Too_bad,_now_who's_gonna_save_Go_00102170]
 00101314 CALL         <EXTERNAL>::puts
 00101319 MOV          EAX,0x0
 0010131e LEAVE
 0010131f RET
```
